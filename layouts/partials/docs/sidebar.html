{{ $logoUrl        := "img/logos/vitess.png" | relURL }}
{{ $docsSections   := where site.Sections "Section" "docs" }}
{{ $currentSection := .CurrentSection.Name }}
{{ $currentUrl     := .RelPermalink }}
{{$currentSubSection := ""}}
<div class="docs-menu">
  <header class="docs-menu-header">
    <a href="{{ site.BaseURL }}">
      <img class="docs-menu-logo" src="{{ $logoUrl }}">
    </a>
  </header>

  <aside class="docs-menu-bar">
    {{ range $docsSections }}
    {{ $isCurrentPage := eq .RelPermalink $currentUrl }}
    <div class="docs-section">
      <a class="docs-section-title{{ if $isCurrentPage }} is-active{{ end }}" href="{{ .RelPermalink }}">
        {{ .Title }}
      </a>
    </div>

    <div class="docs-section">
      <a class="docs-section-title{{ if $isCurrentSection }} is-active{{ end }}" href="{{ .RelPermalink }}">
        {{ .Name }}
      </a>

      {{ if $isCurrentSection }}
      <div class="docs-section-list">
        <ul>
          {{ $is := $page.IsMenuCurrent "main" . }}
          {{ $has := $page.HasMenuCurrent "main" . }}
          {{ if .HasChildren }} 
            <li>
              <a href="{{ .URL }}">
                {{ .Name }}
                {{ if $is }}[Is]{{ end }}
                {{ if $has }}[Has]{{ end }}
                {{ if .HasChildren }}[Children]{{ end }}
              </a>
                <!-- If the menu item has children, include this partial template again (recursively) -->
                {{ partial "menu_recursive.html" (dict "menu" .Children "page" $page "site" $site) }}
            </li>
          {{ else }}
            <li>
              <a href="{{ .URL }}">
                {{ .Name }}
                {{ if $is }}[Is]{{ end }}
                {{ if $has }}[Has]{{ end }}
                {{ if .HasChildren }}[Children]{{ end }}
              </a>
            </li>
          {{ end }}
        {{ end }}
        </ul>

      </div>
      {{ end }}
    </div>
    {{ end }}
    {{ end }}
  </aside>
</div>
