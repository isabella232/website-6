{{ $logoUrl        := "img/logos/vitess.png" | relURL }}
{{ $docsSections   := where site.Sections "Section" "docs" }}
{{ $currentSection := .CurrentSection.Name }}
{{ $currentUrl     := .RelPermalink }}
{{$currentSubSection := ""}}

<div class="docs-menu">
  <header class="docs-menu-header">
    <a href="{{ site.BaseURL }}">
      <img class="docs-menu-logo" src="{{ $logoUrl }}">
    </a>
  </header>

  <aside class="docs-menu-bar">
    {{ range $docsSections }}
    {{ $isCurrentPage := eq .RelPermalink $currentUrl }}
     <div class="docs-section">
      <a class="docs-section-title{{ if $isCurrentPage }} is-active{{ end }}" href="{{ .RelPermalink }}">
        {{ .Title }}
      </a>
    </div>

    {{ range .Sections }}
    {{ $isCurrentSection := eq $currentSection .Name }}

    <div class="docs-section">
      <a class="docs-section-title{{ if $isCurrentSection }} is-active{{ end }}" href="{{ .RelPermalink }}">
        {{ .Name }}
      </a>
    </div>

      {{ if $isCurrentSection }}
      <div class="docs-section-list">   
        <ul>
            {{ $currentPage := . }}
            {{ range .Site.Menus.main }}
              {{ if .HasChildren }}
                  <li class="{{ if $currentPage.HasMenuCurrent "docs" . }}active{{ end }}">
                      <a href="#">
                          {{ .Pre }}
                          <span>{{ .Name }}</span>
                      </a>
                  </li>
                  <ul class="sub-menu">
                      {{ range .Children }}
                          <li class="{{ if $currentPage.IsMenuCurrent "docs" . }}active{{ end }}">
                              <a href="{{ .URL }}">{{ .Name }}</a>
                          </li>
                      {{ end }}
                  </ul>
              {{ else }}
                  <li>
                      <a href="{{ .URL }}">
                          {{ .Pre }}
                          <span>{{ .Name }}</span>
                      </a>
                  </li>
              {{ end }}
            {{ end }}
         </ul>
      </div>
      {{ end }}
    {{ end }}
    {{ end }}
  </aside>
</div>
